<!DOCTYPE html>
<html>

<head>
    <title>Chatbot Site</title>
    <!--Fonts-->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,600,800" rel="stylesheet">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="files/style.css">
</head>

<body>
    <div class="headerText">
        <h1>Secure Chat</h1>
        <div>
            <h4>Your Room ID:</h4>
            <h2 id="roomID"></h2>
        </div>
    </div>
    <div class="centered unselectable">
        <div class="form-group receivedMsg">
            <div class="typewriter">
                <p>This is a sample received message.</p>
            </div>
        </div>
        <div class="input-group">
            <input type="text" class="form-control" autocomplete="off" placeholder="Enter message" id="chatSendInput">
            <span class="input-group-btn">
                <button class="btn btn-success" type="button" id="chatSendBtn">Send</button>
            </span>
        </div>
    </div>
    <div class="bgPattern"></div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io('http://localhost:8082');

        //Clicking Send button
        $('#chatSendBtn').click(function (event) {
            //$('#chatFloatingText').val($('#chatSendInput').val());
            // $('#chatFloatingText').addClass('animate');
            socket.broadcast.to("testroom0").emit('send message', $('#chatSendInput').val());
            $('#chatSendInput').val("");
            /*setTimeout(() => {
                $('#chatFloatingText').removeClass('animate');
            }, 600);*/
        });

        //Pressing enter on input
        $('#chatSendInput').keyup(function () {
            if (event.keyCode === 13) {
                //$('#chatFloatingText').val($('#chatSendInput').val());
                //$('#chatFloatingText').addClass('animate');
                socket.broadcast.to("testroom0").emit('send message', $('#chatSendInput').val());
                $('#chatSendInput').val("");
                /*setTimeout(() => {
                    $('#chatFloatingText').removeClass('animate');
                }, 600);*/
            }
        });

        function getQueryItems() {
            query = {};
            regex = new RegExp(/(?<=(&|\?))\w+=\w+/g);
            while ((result = regex.exec(window.location)) !== null) {
                queryArray = result[0].split("=")
                query[queryArray[0]] = queryArray[1];
            }
            return query;
        }
        query = getQueryItems();
        if (query["room"]) {
            $('#roomID').text(query["room"]);
        } else {
            $('#roomID').text(123);
        }
    </script>
</body>

</html>